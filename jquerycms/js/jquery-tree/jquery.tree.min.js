/* Start noConflict() support*/
(function($){
/*
 * Tree - jQuery Tree Plugin
 * @author Valerio Galano <v.galano@daredevel.com>
 * @license MIT
 * @see https://github.com/daredevel/jquery-tree
 * @version 0.1
 */
$.widget("daredevel.tree",{_attachLi:function(li,parent,position){var ul=parent.find("ul:first");if(ul.length){if((undefined==position)||(ul.children("li").length<position)){ul.append(li)}else{if(position==0){position=position+1}ul.children("li:nth-child("+position+")").before(li)}}else{ul=$("<ul/>");parent.append(ul.append(li))}},_attachNode:function(li,parentLi,position){if(undefined==parentLi){var parent=this.options.core.element;this._attachLi(li,parent,position);this.options.core._initializeNode(li)}else{var parent=parentLi;this._attachLi(li,parent,position);parent.removeClass("leaf collapsed").addClass("expanded");this.options.core._initializeNode(li);this.options.core._initializeNode(parent)}},_buildNode:function(attributes){attributes=$.extend(true,this.options.defaultNodeAttributes,attributes);var span=$("<span/>",attributes.span);var li=$("<li/>",attributes.li);if($.inArray("checkbox",this.options.components)>-1){var input=$("<input/>",attributes.input);li.append(input)}li.append(span);return li},_create:function(){var t=this;this.options.core=this;this.element.addClass("ui-widget ui-widget-content "+this.widgetBaseClass);this._initializeComponents();this.element.find("li").each(function(){t._initializeNode($(this))});if(this.options.nodes!=null){$.each(this.options.nodes,function(key,value){t.options.core.addNode(value)})}},_destroy:function(){$.Widget.prototype.destroy.call(this)},_detachNode:function(li){var parentLi=this.options.core.parentNode(li);var ul=parentLi.find("ul:first");if(ul.children().length==1){ul.detach();parentLi.removeClass("collapsed expanded").addClass("leaf")}else{li.detach()}this.options.core._initializeNode(parentLi)},_initializeComponents:function(){for(var i in this.options.components){var initializeComponent="this.element.tree"+this.options.components[i]+"(this.options)";eval(initializeComponent)}},_initializeNode:function(li){li.children("span:last").addClass(this.options.core.widgetBaseClass+"-label");for(var i in this.options.components){var componentInitializeNode="this._tree"+this.options.components[i]+"InitializeNode(li)";eval(componentInitializeNode)}},addNode:function(attributes,parentLi,position){var t=this;var li=this._buildNode(attributes);if((undefined==parentLi)||0==parentLi.length){this._attachNode($(li),undefined,position)}else{this._attachNode($(li),$(parentLi),position)}if(undefined!=attributes.children){$.each(attributes.children,function(value,key){t.addNode(value,li)})}t._trigger("add",true,li)},isRoot:function(li){li=$(li);var parents=li.parentsUntil("."+this.widgetBaseClass);return 1==parents.length},moveNode:function(li,parentLi,position){this._detachNode($(li));if((undefined==parentLi)||0==parentLi.length){this._attachNode($(li),undefined,position)}else{this._attachNode($(li),$(parentLi),position)}this._trigger("move",true,$(li))},parentNode:function(li){return $(li).parents("li:first")},removeNode:function(li){this._detachNode($(li));this._trigger("remove",true,$(li))},options:{components:[],defaultNodeAttributes:{span:{html:"new node"},li:{"class":"leaf"},input:{type:"checkbox"}},nodes:null}});
/*
 * Tree - jQuery Tree Widget - checkbox component
 * @author Valerio Galano <v.galano@daredevel.com>
 */
$.widget("daredevel.treecheckbox",{_allDescendantChecked:function(li){return(li.find("li input:checkbox:not(:checked)").length==0)},_checkAncestors:function(li){li.parentsUntil(this.options.core.widgetBaseClass).filter("li").find("input:checkbox:first:not(:checked)").prop("checked",true).change()},_checkDescendants:function(li){li.find("li input:checkbox:not(:checked)").prop("checked",true).change()},_checkOthers:function(li){var t=this;li.addClass("exclude");li.parents("li").addClass("exclude");li.find("li").addClass("exclude");$(this.element).find("li").each(function(){if(!$(this).hasClass("exclude")){$(this).find("input:checkbox:first:not(:checked)").prop("checked",true).change()}});$(this.element).find("li").removeClass("exclude")},_create:function(){var t=this;this.element.find("input:checkbox:not(:checked)").live("click",function(){t.uncheck(t.options.core.parentNode($(this)))});this.element.find("input:checkbox:checked").live("click",function(){t.check(t.options.core.parentNode($(this)))});if(this.options.onUncheck.node=="collapse"){this.element.find("input:checkbox:not(:checked)").live("click",function(){t.options.core.collapse(t.options.core.parentNode($(this)))})}else{if(this.options.onUncheck.node=="expand"){this.element.find("input:checkbox:not(:checked)").live("click",function(){t.options.core.expand(t.options.core.parentNode($(this)))})}}if(this.options.onCheck.node=="collapse"){this.element.find("input:checkbox:checked").live("click",function(){t.options.core.collapse(t.options.core.parentNode($(this)))})}else{if(this.options.onCheck.node=="expand"){this.element.find("input:checkbox:checked").live("click",function(){t.options.core.expand(t.options.core.parentNode($(this)))})}}this.options.core.check=function(li){t.check(li)};this.options.core.checkAll=function(){t.checkAll()};this.options.core.uncheck=function(li){t.uncheck(li)};this.options.core.uncheckAll=function(){t.uncheckAll()};this.options.core._treecheckboxInitializeNode=function(li){t._initializeNode(li)}},_initializeNode:function(li){},_uncheckAncestors:function(li){li.parentsUntil(this.options.core.widgetBaseClass).filter("li").find("input:checkbox:first:checked").prop("checked",false).change()},_uncheckDescendants:function(li){li.find("li input:checkbox:checked").prop("checked",false).change()},_uncheckOthers:function(li){var t=this;li.addClass("exclude");li.parents("li").addClass("exclude");li.find("li").addClass("exclude");$(this.element).find("li").each(function(){if(!$(this).hasClass("exclude")){$(this).find("input:checkbox:first:checked").prop("checked",false).change()}});$(this.element).find("li").removeClass("exclude")},check:function(li){li=$(li);li.find("input:checkbox:first:not(:checked)").prop("checked",true).change();if(this.options.onCheck.others=="check"){this._checkOthers(li)}else{if(this.options.onCheck.others=="uncheck"){this._uncheckOthers(li)}}if(this.options.onCheck.descendants=="check"){this._checkDescendants(li)}else{if(this.options.onCheck.descendants=="uncheck"){this._uncheckDescendants(li)}}if(this.options.onCheck.ancestors=="check"){this._checkAncestors(li)}else{if(this.options.onCheck.ancestors=="uncheck"){this._uncheckAncestors(li)}else{if(this.options.onCheck.ancestors=="checkIfFull"){var isRoot=this.options.core.isRoot(li);var allDescendantChecked=this._allDescendantChecked(this.options.core.parentNode(li));if(!isRoot&&allDescendantChecked){this.check(this.options.core.parentNode(li))}}}}},checkAll:function(){$(this.element).find("input:checkbox:not(:checked)").prop("checked",true).change()},uncheck:function(li){li=$(li);li.find("input:checkbox:first:checked").prop("checked",false).change();if(this.options.onUncheck.others=="check"){this._checkOthers(li)}else{if(this.options.onUncheck.others=="uncheck"){this._uncheckOthers(li)}}if(this.options.onUncheck.descendants=="check"){this._checkDescendants(li)}else{if(this.options.onUncheck.descendants=="uncheck"){this._uncheckDescendants(li)}}if(this.options.onUncheck.ancestors=="check"){this._checkAncestors(li)}else{if(this.options.onUncheck.ancestors=="uncheck"){this._uncheckAncestors(li)}}},uncheckAll:function(){$(this.element).find("input:checkbox:checked").prop("checked",false).change()},options:{onCheck:{ancestors:"check",descendants:"check",node:"",others:""},onUncheck:{ancestors:"",descendants:"uncheck",node:"",others:""}}});
/*
 * Tree - jQuery Tree Widget - collapse component
 * @author Valerio Galano <v.galano@daredevel.com>
 */
$.widget("daredevel.treecollapse",{_create:function(){var t=this;this.element.find("li span."+this.widgetBaseClass+"-anchor").live("click",function(){var li=t.options.core.parentNode($(this));if(li.hasClass("collapsed")){t.expand(li)}else{if(li.hasClass("expanded")){t.collapse(li)}}});this.options.core.collapse=function(li){t.collapse(li)};this.options.core.collapseAll=function(){t.collapseAll()};this.options.core.expand=function(li){t.expand(li)};this.options.core.expandAll=function(){t.expandAll()};this.options.core._treecollapseInitializeNode=function(li){t._initializeNode(li)}},_initializeNode:function(li){var t=this;var anchor=li.children("span."+this.widgetBaseClass+"-anchor");if(anchor.length<1){li.prepend($("<span />",{"class":this.widgetBaseClass+"-anchor"}))}if(li.hasClass("leaf")){t._markAsLeaf(li)}else{if(li.hasClass("collapsed")){t.collapse(li,false,true)}else{if(li.hasClass("expanded")){t.expand(li,false,true)}else{if(li.is("li:not(:has(ul))")){t._markAsLeaf(li)}else{t._markAsExpanded(li)}}}}},_markAsCollapsed:function(li){var anchor=li.children("span."+this.widgetBaseClass+"-anchor");anchor.removeClass("ui-icon "+this.options.expandUiIcon+" "+this.options.leafUiIcon);if(this.options.collapseUiIcon.length>0){anchor.addClass("ui-icon "+this.options.collapseUiIcon)}li.removeClass("leaf").removeClass("expanded").addClass("collapsed")},_markAsExpanded:function(li){var anchor=li.children("span."+this.widgetBaseClass+"-anchor");anchor.removeClass("ui-icon "+this.options.collapseUiIcon+" "+this.options.leafUiIcon);if(this.options.expandUiIcon.length>0){anchor.addClass("ui-icon "+this.options.expandUiIcon)}li.removeClass("leaf").removeClass("collapsed").addClass("expanded")},_markAsLeaf:function(li){var anchor=li.children("span."+this.widgetBaseClass+"-anchor");anchor.removeClass("ui-icon "+this.options.collapseUiIcon+" "+this.options.expandUiIcon);if(this.options.leafUiIcon.length>0){anchor.addClass("ui-icon "+this.options.leafUiIcon)}li.removeClass("collapsed").removeClass("expanded").addClass("leaf")},_unmark:function(){li.removeClass("collapsed expanded leaf")},collapse:function(li,effect,force){li=$(li);if(force==undefined){force=false}if(!force&&(li.hasClass("collapsed")||li.hasClass("leaf"))){return}if(effect==undefined){effect=true}var t=this;if(effect){li.children("ul").hide(this.options.collapseEffect,{},this.options.collapseDuration);setTimeout(function(){t._markAsCollapsed(li,t.options)},t.options.collapseDuration)}else{li.children("ul").hide();t._markAsCollapsed(li,t.options)}t.options.core._trigger("collapse",true,li)},collapseAll:function(){var t=this;$(this.element).find("li.expanded").each(function(){t.collapse($(this))})},expand:function(li,effect,force){li=$(li);if(force==undefined){force=false}if(!force&&(li.hasClass("expanded")||li.hasClass("leaf"))){return}if(effect==undefined){effect=true}var t=this;if(effect){li.children("ul").show(t.options.expandEffect,{},t.options.expandDuration);setTimeout(function(){t._markAsExpanded(li,t.options)},t.options.expandDuration)}else{li.children("ul").show();t._markAsExpanded(li,t.options)}t.options.core._trigger("expand",true,li)},expandAll:function(){var t=this;$(this.element).find("li.collapsed").each(function(){t.expand($(this))})},options:{collapseDuration:500,collapseEffect:"blind",collapseUiIcon:"ui-icon-triangle-1-e",expandDuration:500,expandEffect:"blind",expandUiIcon:"ui-icon-triangle-1-se",leafUiIcon:""}});
/*
 * Tree - jQuery Tree Widget - drag and drop component
 * @author Valerio Galano <v.galano@daredevel.com>
 */
$.widget("daredevel.treednd",{_create:function(){var t=this;this.options.core._treedndInitializeNode=function(li){t._initializeNode(li)}},_initializeNode:function(li){var t=this;var span=$("<span/>",{"class":"prepended",html:"<br/>"}).droppable({hoverClass:"over",drop:function(event,ui){var li=$(this).closest("li");if(t.options.core.isRoot(li)){var parentLi=undefined;var droppable=t.options.core.element}else{var parentLi=li.parent().closest("li");var droppable=parentLi;if($(ui.draggable.parent("li")).find(parentLi).length){return}}var position=$($(this).parent("li")).index()+1;t.options.core.moveNode(ui.draggable.parent("li"),parentLi,position);t._trigger("drop",event,{draggable:ui.draggable,droppable:parentLi})}});$(li).find("."+this.options.core.widgetBaseClass+"-label:first").after(span);$(li).find("."+this.options.core.widgetBaseClass+"-label:first").draggable({start:function(event,ui){$(this).parent("li").find("ul, .prepended").css("visibility","hidden");$(this).parent("li").find(".droppable-label").css("display","none")},stop:function(event,ui){$(this).parent("li").find("ul").css("visibility","visible");$(this).parent("li").find(".prepended").css("visibility","");$(this).parent("li").find(".droppable-label").css("display","inherit")},revert:true,revertDuration:0});var span=$("<span/>",{"class":"droppable-label",html:"<br/>"}).droppable({drop:function(event,ui){var li=$(this).closest("li");if($(ui.draggable.parent("li")).find(li).length){return}t.options.core.moveNode(ui.draggable.parent("li"),li,1);t._trigger("drop",event,{draggable:ui.draggable,droppable:li})},over:function(event,ui){$(this).parent("li").find("."+t.options.core.widgetBaseClass+"-label:first").addClass("ui-state-hover")},out:function(event,ui){$(this).parent("li").find("."+t.options.core.widgetBaseClass+"-label:first").removeClass("ui-state-hover")}});$(li).find("."+this.options.core.widgetBaseClass+"-label:first").after(span)},options:{drop:function(event,element){}}});$.ui.draggable.prototype._getRelativeOffset=function(){if(this.cssPosition=="relative"){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0),left:p.left-(parseInt(this.helper.css("left"),10)||0)}}else{return{top:0,left:0}}};
/*
 * Tree - jQuery Tree Widget - select component
 * @author Valerio Galano <v.galano@daredevel.com>
 */
$.widget("daredevel.treeselect",{_create:function(){var t=this;var selector="."+this.options.core.widgetBaseClass+"-label:not(."+this.options.selectUiClass+")";this.element.find(selector).live("click",function(){t.select($(this).parent("li"))});this.options.core.deselect=function(li){return t.deselect(li)};this.options.core.select=function(li){return t.select(li)};this.options.core.selected=function(){return t.selected()};this.options.core._treeselectInitializeNode=function(li){t._initializeNode(li)}},_deselect:function(li){li.find("span."+this.options.core.widgetBaseClass+"-label:first").removeClass(this.options.selectUiClass);this._trigger("deselect",true,li)},_destroy:function(){},_initializeNode:function(li){},_select:function(li){li.find("span."+this.options.core.widgetBaseClass+"-label:first").addClass(this.options.selectUiClass);this._trigger("select",true,li)},deselect:function(){var t=this;this.element.find("."+this.options.core.widgetBaseClass+"-label."+this.options.selectUiClass).each(function(){t._deselect($(this).parent("li"))})},select:function(li){li=$(li);var t=this;this.deselect();this._select(li)},selected:function(){var selected=this.element.find("."+this.options.core.widgetBaseClass+"-label."+this.options.selectUiClass);return $(selected).parent()},options:{deselect:function(event,element){},select:function(event,element){},selectUiClass:"ui-state-active"}});
/* End noConflict() support*/
}(jQuery));